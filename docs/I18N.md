# i18n (Internationalization) Support

## Overview

Internationalization support across all services with locale detection, translation files, and locale-specific formatting.

## Implementation

### 1. i18n Middleware

All services use `I18nMiddleware()` from `common-go/middleware/i18n.go`:

```go
router.Use(middleware.I18nMiddleware())
```

This middleware:
- Parses `Accept-Language` header
- Detects best matching locale
- Sets locale in request context

### 2. Supported Languages

- `en-US`: English (US)
- `es-ES`: Spanish (Spain)
- `fr-FR`: French (France)
- `de-DE`: German (Germany)
- `pt-BR`: Portuguese (Brazil)
- `ja-JP`: Japanese (Japan)
- `zh-CN`: Chinese (Simplified)

### 3. Translation Files

Translations stored in `packages/common-go/i18n/translations.go`:

```go
localize := i18n.GetLocalizer("es-ES")
message := localize("subscription.active", "premium")
// Output: "Tu suscripción premium está activa"
```

### 4. Using Translations in Handlers

```go
func (h *PaymentHandler) GetSubscription(c *gin.Context) {
    locale := middleware.GetLocale(c)
    localize := i18n.GetLocalizer(locale)
    
    subscription, err := h.service.GetSubscription(ctx, userID)
    if err != nil {
        message := localize("subscription.expired")
        c.JSON(http.StatusNotFound, gin.H{"error": message})
        return
    }
    
    c.JSON(http.StatusOK, subscription)
}
```

### 5. Date/Time Formatting

```go
import "github.com/streamverse/common-go/i18n"

locale := middleware.GetLocale(c)
formattedDate := i18n.FormatDate(locale, time.Now())
// en-US: "01/15/2024"
// es-ES: "15/01/2024"
// fr-FR: "15.01.2024"
// ja-JP: "2024年01月15日"
```

### 6. Currency Formatting

```go
formattedCurrency := i18n.FormatCurrency(locale, 19.99, "USD")
// en-US: "USD19.99"
// es-ES: "19.99 USD"
// ja-JP: "USD20"
```

## Elasticsearch Analyzers

Search Service uses language-specific analyzers:

```json
{
  "settings": {
    "analysis": {
      "analyzer": {
        "english": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": ["lowercase", "english_stemmer", "english_stop"]
        },
        "spanish": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": ["lowercase", "spanish_stemmer", "spanish_stop"]
        },
        "french": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": ["lowercase", "french_stemmer", "french_stop"]
        }
      }
    }
  }
}
```

## API Usage

### Client Request

```bash
curl -X GET "https://api.streamverse.io/content/123" \
  -H "Accept-Language: es-ES"
```

### Response

Error messages, status messages, and user-facing text will be in Spanish:

```json
{
  "error": "Contenido no encontrado",
  "message": "Tu suscripción premium está activa"
}
```

## Adding New Translations

1. Add translations to `packages/common-go/i18n/translations.go`:

```go
"de-DE": {
    "subscription.active": "Ihr %s Abonnement ist aktiv",
    // ... more translations
}
```

2. Add locale to `SupportedLocales` in `middleware/i18n.go`

3. Add Elasticsearch analyzer for the language

## Acceptance Criteria

- ✅ API returns responses in requested language
- ✅ Elasticsearch search works across languages
- ✅ Date/time formatted per locale
- ✅ Currency displayed per region
- ✅ All endpoints tested with different locales

